apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ingress-nginx
  namespace: ingress-nginx
spec:
  releaseName: ingress-nginx
  chart:
    spec:
      chart: ingress-nginx
      version: "4.7.1"
  values:
   controller:
    image:
        registry: tpspacr.azurecr.io
        image: ingress-nginx/controller
    service:
      loadBalancerIP: 10.87.68.250
      externalTrafficPolicy: Local
      annotations:
        service.beta.kubernetes.io/azure-load-balancer-internal: "true"
    config:
      proxy-body-size: "0"
      proxy-read-timeout: 120
      proxy-send-timeout: 120
    nodeSelector:
        kubernetes.azure.com/mode: user
    tolerations:
    - key: "mode"
      operator: "Equal"
      value: "system"
      effect: "NoSchedule"
    - key: "kubernetes.azure.com/scalesetpriority"
      operator: "Equal"
      value: "spot"
      effect: "NoSchedule"
    admissionWebhooks:
      patch:
        enabled: true
        image:
            registry: tpspacr.azurecr.io
            image: ingress-nginx/kube-webhook-certgen
    